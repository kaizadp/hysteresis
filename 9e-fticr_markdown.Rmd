---
title: "9e-fticr_markdown"
author: "Kaizad Patel"
date: "4/8/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE,message=FALSE,warning=FALSE,
                      collapse = TRUE,
                      comment = "#>", 
                      fig.path = "images/9-fticr_markdown/"
                      )
```

```{r}
source("0-hysteresis_packages.R")

fticr_data = read.csv(FTICR_LONG)
fticr_meta = read.csv(FTICR_META)
meta_hcoc = read.csv(FTICR_META_HCOC)


relabund = read.csv("data/processed/fticr_relabund.csv")
corekey = read.csv(COREKEY)

corekey_subset = 
  corekey %>% 
  dplyr::select(Core, texture, treatment, perc_sat, sat_level,Core_assignment) %>% 
  dplyr::mutate(Core = as.factor(Core))

```

## VAN KREVELEN DOMAINS

```{r vk_domains, fig.asp=1, fig.height=5}
gg_vankrev(fticr_meta, aes(x = OC, y = HC, color = Class))+
  scale_color_viridis_d(option = "inferno")+
  theme_kp()
```


## VAN KREVELEN PLOTS
```{r vk, fig.height=12, fig.width=16}
fticr = 
  fticr_data %>% 
  dplyr::mutate(sat_level = if_else(treatment == "FM", 50, as.numeric(sat_level))) %>% 
  left_join(fticr_meta, by = "formula")

gg_vankrev(fticr, aes(x = OC, y = HC, color = treatment))+
  geom_point(alpha = 0.1)+
  facet_grid(treatment+texture~sat_level)+
  theme_kp()+
  ggtitle("peaks seen in all 5 replicates")
```

```{r vk2, fig.height = 6, fig.width=10}
fticr_subset = 
  fticr %>% 
  filter(sat_level %in% c(50,100)) %>% 
  filter(!(sat_level==50 & (treatment == "Drying"|treatment=="Wetting")))

gg_fm = gg_vankrev(fticr_subset[fticr_subset$treatment=="FM",], aes(x = OC, y = HC, color = treatment))+
  theme_kp()

gg_100_d = 
  fticr_subset %>% 
  filter(sat_level==100) %>% 
  #dplyr::mutate(treatment = factor(treatment, levels = c("Wetting", "Drying"))) %>% 
  gg_vankrev( 
             aes(x = OC, y = HC, color = treatment, group = rev(treatment)))+
  scale_color_manual(values = c("darkorange2", "grey40"))+
  #geom_point(size=0.5, alpha = 0.4)+
  #facet_grid(.~treatment)+
  theme_kp()
  aes(group=rev(treatment))


library(patchwork)
gg_fm + gg_100

```

```{r vk2_marginal, fig.height=5, fig.width=5}

ggMarginal(gg_fm,groupColour = TRUE,groupFill = TRUE)
```

```{r vk2_marginal2, fig.height=5, fig.width=5}
ggMarginal(gg_100,groupColour = TRUE,groupFill = TRUE)

```

## RELATIVE ABUNDANCE


field moist soils

```{r}
relabund %>% 
  filter(treatment=="FM") %>% 
  dplyr::select(Class, texture, relabund) %>% 
  spread(texture, relabund) %>% 
  knitr::kable(align = "r")
```


treatment
```{r}
relabund %>% 
  filter(!treatment == "FM") %>% 
  dplyr::mutate(var = paste0(texture,"-",treatment)) %>% 
  dplyr::select(sat_level, Class, var, relabund) %>% 
   
  spread(var, relabund) %>% 
  knitr::kable(align = "r")
```

